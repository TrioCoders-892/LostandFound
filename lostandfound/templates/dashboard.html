<!doctype html>
<html>
  <head>
    <title>Dashboard - Lost & Found</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
  </head>
  <body>
    <div class="dashboard-container">
      {% include 'sidebar.html' %}
      <main class="dashboard-main">
        <h1>Welcome, {{ session['username'] }}</h1>
        <h2>All Lost & Found Items</h2>
        <div class="items">
          {% for item in items %}
          <div class="item-card {% if item.status == 'lost' %}lost-card{% elif item.status == 'found' %}found-card{% endif %}" style="width: 270px; min-height: 320px; margin: 18px; display: inline-block; vertical-align: top;">
            <div class="item-user" style="font-weight:600; color:#1976d2; margin-bottom:8px; font-size:1.05rem;">
              <span>{{ item.username }}</span>
            </div>
            {% if item.image %}
            <img src="{{ url_for('static', filename='uploads/' ~ item.image) }}" alt="{{ item.title }}" style="max-width: 220px; max-height: 160px; object-fit: cover; border-radius: 10px; margin-bottom: 8px; display: block; margin-left: auto; margin-right: auto;" />
            {% endif %}
            <h3>{{ item.title }}</h3>
            <p>{{ item.description }}</p>
            <small>
              Status: <span class="status-label {% if item.status == 'lost' %}lost-status{% elif item.status == 'found' %}found-status{% endif %}">{{ item.status }}</span>
              {% if item.status == 'found' and item.returned %}
                <span style="color:#1976d2; font-weight:600;">(Returned)</span>
              {% endif %}
              | Location: {{ item.location }} | Block: {{ item.block }}
            </small>
            {% if item.status == 'lost' and item.user_id == session['user_id'] %}
            <form method="POST" action="{{ url_for('mark_found', item_id=item._id) }}">
              <button type="submit" class="btn-mark-found">Mark as Found</button>
            </form>
            {% endif %}
            {% if 'user_id' in session and item.user_id != session['user_id'] %}
            <div class="item-actions">
              <a href="{{ url_for('conversation', item_id=item._id) }}" class="btn-contact">Contact Owner/Finder</a>
            </div>
            {% endif %}
          </div>
          {% endfor %}
          {% if not items %}
          <div class="no-items">
            <h3>No items found.</h3>
            <p>Click "Add Item" to report a lost or found item.</p>
          </div>
          {% endif %}
        </div>
      </main>
    </div>
  </body>
</html>
